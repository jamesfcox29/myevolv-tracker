<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyEvolv Entry Tracker v4.0</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0a0e1a;
            --color-surface: #151b2e;
            --color-surface-hover: #1d2539;
            --color-border: #2a3447;
            --color-primary: #4a9eff;
            --color-primary-dark: #3182ce;
            --color-success: #48bb78;
            --color-warning: #ed8936;
            --color-danger: #f56565;
            --color-text: #e2e8f0;
            --color-text-secondary: #94a3b8;
            --color-text-tertiary: #64748b;
            
            --font-sans: 'Work Sans', system-ui, -apple-system, sans-serif;
            --font-mono: 'IBM Plex Mono', 'Courier New', monospace;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #0a0e1a 0%, #151b2e 100%);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            background: var(--color-surface);
            border-bottom: 2px solid var(--color-primary);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-md);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .app-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-text);
            letter-spacing: -0.02em;
        }
        
        .app-title .badge {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            background: var(--color-primary);
            color: var(--color-bg);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-email {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--color-text-secondary);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
        }
        
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .login-box {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 3rem;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-lg);
        }
        
        .login-box h2 {
            font-size: 1.875rem;
            margin-bottom: 0.5rem;
            text-align: center;
            color: var(--color-text);
        }
        
        .login-box p {
            color: var(--color-text-secondary);
            text-align: center;
            margin-bottom: 2rem;
            font-size: 0.875rem;
        }
        
        .signup-link {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            font-size: 0.875rem;
        }
        
        .signup-link button {
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.875rem;
            padding: 0;
            font-family: var(--font-sans);
        }
        
        .signup-link button:hover {
            color: var(--color-primary-dark);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--color-text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-family: var(--font-sans);
            font-size: 0.9375rem;
            transition: all 0.2s;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-family: var(--font-sans);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .btn-primary {
            background: var(--color-primary);
            color: var(--color-bg);
        }
        
        .btn-primary:hover {
            background: var(--color-primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--color-surface-hover);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }
        
        .btn-secondary:hover {
            background: var(--color-border);
        }
        
        .btn-full {
            width: 100%;
            justify-content: center;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
        }
        
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--color-border);
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-family: var(--font-sans);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .tab:hover {
            color: var(--color-text);
        }
        
        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }
        
        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }
        
        .card h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .table-container {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .table-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h3 {
            font-size: 1.25rem;
            color: var(--color-text);
        }
        
        .search-box {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            max-width: 400px;
        }
        
        .search-input {
            flex: 1;
            padding: 0.5rem 1rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 0.875rem;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: var(--color-bg);
        }
        
        th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--color-border);
        }
        
        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--color-border);
            font-size: 0.9375rem;
        }
        
        tbody tr {
            transition: background 0.2s;
            cursor: pointer;
        }
        
        tbody tr:hover {
            background: var(--color-surface-hover);
        }
        
        .mono {
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-completed {
            background: rgba(72, 187, 120, 0.2);
            color: var(--color-success);
        }
        
        .status-pending {
            background: rgba(237, 137, 54, 0.2);
            color: var(--color-warning);
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--color-text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        
        .alert-success {
            background: rgba(72, 187, 120, 0.2);
            color: var(--color-success);
            border: 1px solid var(--color-success);
        }
        
        .alert-error {
            background: rgba(245, 101, 101, 0.2);
            color: var(--color-danger);
            border: 1px solid var(--color-danger);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-primary);
            font-family: var(--font-mono);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }
        
        .modal-content {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--color-text);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: var(--color-surface-hover);
            color: var(--color-text);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .detail-section {
            margin-bottom: 2rem;
        }
        
        .detail-section h4 {
            font-size: 1rem;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border);
        }
        
        .detail-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(42, 52, 71, 0.5);
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
        }
        
        .detail-value {
            color: var(--color-text);
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--color-border);
        }
        
        .ce-high-priority {
            background: rgba(237, 137, 54, 0.3);
            color: var(--color-warning);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .system-filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-sans);
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background: var(--color-surface-hover);
            color: var(--color-text);
        }
        
        .filter-btn.active {
            background: var(--color-primary);
            color: var(--color-bg);
            border-color: var(--color-primary);
        }
        
        .status-icon {
            display: inline-block;
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .app-header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .detail-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .modal-overlay {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const SUPABASE_URL = 'https://wvvepssoltooeeqqvnul.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2dmVwc3NvbHRvb2VlcXF2bnVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNDA3MDgsImV4cCI6MjA4MzcxNjcwOH0.xPFDECNheYPrxYTBfQ3IwbUY27UNfqMMojBvnB6ArnQ';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('add');
            const [entries, setEntries] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [message, setMessage] = useState({ type: '', text: '' });
            const [isSignup, setIsSignup] = useState(false);
            const [selectedEntry, setSelectedEntry] = useState(null);
            const [editingEntry, setEditingEntry] = useState(null);
            const [systemFilter, setSystemFilter] = useState('all');

            const [formData, setFormData] = useState({
                client_id: '',
                entry_type: '',
                entry_date: new Date().toISOString().split('T')[0],
                program: 'PATH',
                status: 'completed',
                notes: '',
                voucher_awarded: false,
                voucher_date: null,
                voucher_type: '',
                voucher_amount: '',
                voucher_status: '',
                case_conferencing_awarded: false,
                subsidy_type: '',
                subsidy_provider_status: '',
                landlord_name: '',
                landlord_phone: '',
                landlord_email: '',
                property_address: '',
                ce_score: '',
                myevolv_entry_level: '',
                hmis_entered: false,
                myevolv_entered: false,
                hmis_id: '',
                last_service_date: new Date().toISOString().split('T')[0],
                case_manager: '',
                dob: '',
                has_insurance: false,
                has_ssn: false
            });

            useEffect(() => {
                checkUser();
                
                const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
                    setUser(session?.user ?? null);
                    setLoading(false);
                });

                return () => {
                    authListener?.subscription?.unsubscribe();
                };
            }, []);

            useEffect(() => {
                if (user) {
                    fetchEntries();
                }
            }, [user]);

            const checkUser = async () => {
                const { data: { session } } = await supabase.auth.getSession();
                setUser(session?.user ?? null);
                setLoading(false);
            };

            const fetchEntries = async () => {
                const { data, error } = await supabase
                    .from('myevolv_entries')
                    .select('*')
                    .order('entry_date', { ascending: false });

                if (!error && data) {
                    setEntries(data);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                const password = e.target.password.value;

                const { error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) {
                    setMessage({ type: 'error', text: error.message });
                } else {
                    setMessage({ type: 'success', text: 'Login successful!' });
                }
            };

            const handleSignup = async (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                const password = e.target.password.value;
                const confirmPassword = e.target.confirmPassword.value;

                if (password !== confirmPassword) {
                    setMessage({ type: 'error', text: 'Passwords do not match!' });
                    return;
                }

                if (password.length < 6) {
                    setMessage({ type: 'error', text: 'Password must be at least 6 characters!' });
                    return;
                }

                const { error } = await supabase.auth.signUp({
                    email,
                    password
                });

                if (error) {
                    setMessage({ type: 'error', text: error.message });
                } else {
                    setMessage({ type: 'success', text: 'Account created! You can now log in.' });
                    setIsSignup(false);
                }
            };

            const handleLogout = async () => {
                await supabase.auth.signOut();
                setUser(null);
                setEntries([]);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();

                const { data, error } = await supabase
                    .from('myevolv_entries')
                    .insert([{
                        ...formData,
                        user_id: user.id,
                        user_email: user.email,
                        created_at: new Date().toISOString()
                    }])
                    .select();

                if (error) {
                    setMessage({ type: 'error', text: error.message });
                } else {
                    setMessage({ type: 'success', text: 'Entry logged successfully!' });
                    setFormData({
                        client_id: '',
                        entry_type: '',
                        entry_date: new Date().toISOString().split('T')[0],
                        program: 'PATH',
                        status: 'completed',
                        notes: '',
                        voucher_awarded: false,
                        voucher_date: null,
                        voucher_type: '',
                        voucher_amount: '',
                        voucher_status: '',
                        case_conferencing_awarded: false,
                        subsidy_type: '',
                        subsidy_provider_status: '',
                        landlord_name: '',
                        landlord_phone: '',
                        landlord_email: '',
                        property_address: '',
                        ce_score: '',
                        myevolv_entry_level: '',
                        hmis_entered: false,
                        myevolv_entered: false,
                        hmis_id: '',
                        last_service_date: new Date().toISOString().split('T')[0],
                        case_manager: '',
                        dob: '',
                        has_insurance: false,
                        has_ssn: false
                    });
                    fetchEntries();
                    
                    setTimeout(() => setMessage({ type: '', text: '' }), 3000);
                }
            };

            const handleUpdate = async (e) => {
                e.preventDefault();
                
                const { data, error } = await supabase
                    .from('myevolv_entries')
                    .update(editingEntry)
                    .eq('id', editingEntry.id)
                    .select();

                if (error) {
                    setMessage({ type: 'error', text: error.message });
                } else {
                    setMessage({ type: 'success', text: 'Entry updated successfully!' });
                    setEditingEntry(null);
                    fetchEntries();
                    setTimeout(() => setMessage({ type: '', text: '' }), 3000);
                }
            };

            const isCEHighPriority = (score) => {
                if (!score) return false;
                const num = parseInt(score);
                return num >= 14 && num <= 16;
            };

            const getSystemStatus = (entry) => {
                if (entry.hmis_entered && entry.myevolv_entered) return 'both';
                if (entry.hmis_entered) return 'hmis_only';
                if (entry.myevolv_entered) return 'myevolv_only';
                return 'neither';
            };

            const filteredEntries = entries.filter(entry => {
                const search = searchTerm.toLowerCase();
                const matchesSearch = (
                    entry.client_id?.toLowerCase().includes(search) ||
                    entry.entry_type?.toLowerCase().includes(search) ||
                    entry.program?.toLowerCase().includes(search) ||
                    entry.hmis_id?.toLowerCase().includes(search) ||
                    entry.case_manager?.toLowerCase().includes(search) ||
                    entry.notes?.toLowerCase().includes(search)
                );
                
                let matchesSystem = true;
                if (systemFilter !== 'all') {
                    const status = getSystemStatus(entry);
                    matchesSystem = status === systemFilter;
                }
                
                return matchesSearch && matchesSystem;
            });

            const stats = {
                total: entries.length,
                thisWeek: entries.filter(e => {
                    const entryDate = new Date(e.entry_date);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return entryDate >= weekAgo;
                }).length,
                thisMonth: entries.filter(e => {
                    const entryDate = new Date(e.entry_date);
                    const monthAgo = new Date();
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    return entryDate >= monthAgo;
                }).length,
                hmisOnly: entries.filter(e => e.hmis_entered && !e.myevolv_entered).length,
                myevolvOnly: entries.filter(e => e.myevolv_entered && !e.hmis_entered).length,
                both: entries.filter(e => e.hmis_entered && e.myevolv_entered).length,
                neither: entries.filter(e => !e.hmis_entered && !e.myevolv_entered).length
            };

            if (loading) {
                return <div className="login-container">Loading...</div>;
            }

            if (!user) {
                return (
                    <div className="login-container">
                        <div className="login-box">
                            <h2>MyEvolv Tracker</h2>
                            <p>{isSignup ? 'Create your account' : 'Track your PATH data entry work'}</p>
                            
                            {message.text && (
                                <div className={`alert alert-${message.type}`}>
                                    {message.text}
                                </div>
                            )}
                            
                            {!isSignup ? (
                                <form onSubmit={handleLogin}>
                                    <div className="form-group">
                                        <label className="form-label">Email</label>
                                        <input type="email" name="email" className="form-input" required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Password</label>
                                        <input type="password" name="password" className="form-input" required />
                                    </div>
                                    <button type="submit" className="btn btn-primary btn-full">Sign In</button>
                                    <div className="signup-link">
                                        Don't have an account? <button type="button" onClick={() => setIsSignup(true)}>Create Account</button>
                                    </div>
                                </form>
                            ) : (
                                <form onSubmit={handleSignup}>
                                    <div className="form-group">
                                        <label className="form-label">Email</label>
                                        <input type="email" name="email" className="form-input" required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Password</label>
                                        <input type="password" name="password" className="form-input" minLength="6" required />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Confirm Password</label>
                                        <input type="password" name="confirmPassword" className="form-input" minLength="6" required />
                                    </div>
                                    <button type="submit" className="btn btn-primary btn-full">Create Account</button>
                                    <div className="signup-link">
                                        Already have an account? <button type="button" onClick={() => setIsSignup(false)}>Sign In</button>
                                    </div>
                                </form>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <>
                    <header className="app-header">
                        <div className="header-content">
                            <div className="app-title">
                                <h1>MyEvolv Entry Tracker</h1>
                                <span className="badge">v4.0</span>
                            </div>
                            <div className="user-info">
                                <span className="user-email">{user.email}</span>
                                <button onClick={handleLogout} className="btn btn-secondary">Sign Out</button>
                            </div>
                        </div>
                    </header>

                    <div className="container">
                        {message.text && (
                            <div className={`alert alert-${message.type}`}>
                                {message.text}
                            </div>
                        )}

                        <div className="tabs">
                            <button className={`tab ${activeTab === 'add' ? 'active' : ''}`} onClick={() => setActiveTab('add')}>
                                Log Entry
                            </button>
                            <button className={`tab ${activeTab === 'view' ? 'active' : ''}`} onClick={() => setActiveTab('view')}>
                                View All Entries
                            </button>
                            <button className={`tab ${activeTab === 'reports' ? 'active' : ''}`} onClick={() => setActiveTab('reports')}>
                                Monthly Reports
                            </button>
                        </div>

                        {activeTab === 'add' && (
                            <div className="card">
                                <h3>üìù Log New PATH Entry</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">Client ID / Initials</label>
                                            <input type="text" className="form-input" value={formData.client_id}
                                                onChange={(e) => setFormData({...formData, client_id: e.target.value})} required />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">HMIS ID</label>
                                            <input type="text" className="form-input" value={formData.hmis_id}
                                                onChange={(e) => setFormData({...formData, hmis_id: e.target.value})} />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">CE Score</label>
                                            <input type="text" className="form-input" value={formData.ce_score}
                                                onChange={(e) => setFormData({...formData, ce_score: e.target.value})} 
                                                placeholder="14-16 = HIGH PRIORITY" />
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">Date of Birth</label>
                                            <input type="date" className="form-input" value={formData.dob}
                                                onChange={(e) => setFormData({...formData, dob: e.target.value})} />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Case Manager</label>
                                            <input type="text" className="form-input" value={formData.case_manager}
                                                onChange={(e) => setFormData({...formData, case_manager: e.target.value})}
                                                placeholder="Your name or colleague's name" />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Last Service Date</label>
                                            <input type="date" className="form-input" value={formData.last_service_date}
                                                onChange={(e) => setFormData({...formData, last_service_date: e.target.value})} />
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                                <input type="checkbox" checked={formData.has_insurance}
                                                    onChange={(e) => setFormData({...formData, has_insurance: e.target.checked})}
                                                    style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                                <span className="form-label" style={{margin: 0}}>Has Insurance</span>
                                            </label>
                                        </div>
                                        <div className="form-group">
                                            <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                                <input type="checkbox" checked={formData.has_ssn}
                                                    onChange={(e) => setFormData({...formData, has_ssn: e.target.checked})}
                                                    style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                                <span className="form-label" style={{margin: 0}}>Has Social Security Info</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">Entry Type</label>
                                            <select className="form-select" value={formData.entry_type}
                                                onChange={(e) => setFormData({...formData, entry_type: e.target.value})} required>
                                                <option value="">Select type...</option>
                                                <option value="full_enrollment">Full PATH Enrollment</option>
                                                <option value="partial_enrollment">Partial Enrollment</option>
                                                <option value="ce_standalone">Stand-Alone CE Assessment (required for PATH)</option>
                                                <option value="ce_with_enrollment">CE + Enrollment</option>
                                                <option value="service">Service Provision</option>
                                                <option value="case_note">Case Note/Contact</option>
                                                <option value="voucher_issued">Voucher Issued</option>
                                                <option value="follow_up">Follow-up</option>
                                                <option value="discharge">Discharge</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">MyEvolv Entry Level</label>
                                            <select className="form-select" value={formData.myevolv_entry_level}
                                                onChange={(e) => setFormData({...formData, myevolv_entry_level: e.target.value})}>
                                                <option value="">Select level...</option>
                                                <option value="full_enrollment">Full Enrollment</option>
                                                <option value="service_only">Service Only</option>
                                                <option value="ce_only">Coordinated Entry Only</option>
                                                <option value="not_entered">Not Entered Yet</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label className="form-label">Entry Date</label>
                                            <input type="date" className="form-input" value={formData.entry_date}
                                                onChange={(e) => setFormData({...formData, entry_date: e.target.value})} required />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Status</label>
                                            <select className="form-select" value={formData.status}
                                                onChange={(e) => setFormData({...formData, status: e.target.value})}>
                                                <option value="completed">Completed</option>
                                                <option value="pending">Pending</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="form-row">
                                        <div className="form-group">
                                            <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                                <input type="checkbox" checked={formData.hmis_entered}
                                                    onChange={(e) => setFormData({...formData, hmis_entered: e.target.checked})}
                                                    style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                                <span className="form-label" style={{margin: 0}}>Entered into HMIS</span>
                                            </label>
                                        </div>
                                        <div className="form-group">
                                            <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                                <input type="checkbox" checked={formData.myevolv_entered}
                                                    onChange={(e) => setFormData({...formData, myevolv_entered: e.target.checked})}
                                                    style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                                <span className="form-label" style={{margin: 0}}>Entered into MyEvolv</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Notes (Optional)</label>
                                        <textarea className="form-textarea" value={formData.notes}
                                            onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                            placeholder="Add any additional details or issues..." />
                                    </div>

                                    <div className="form-group" style={{marginTop: '2rem', paddingTop: '2rem', borderTop: '1px solid var(--color-border)'}}>
                                        <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                            <input type="checkbox" checked={formData.voucher_awarded}
                                                onChange={(e) => setFormData({...formData, voucher_awarded: e.target.checked})}
                                                style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                            <span className="form-label" style={{margin: 0}}>üé´ Voucher Awarded (HIGH PRIORITY)</span>
                                        </label>
                                    </div>

                                    {formData.voucher_awarded && (
                                        <>
                                            <div className="form-group">
                                                <label style={{display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer'}}>
                                                    <input type="checkbox" checked={formData.case_conferencing_awarded}
                                                        onChange={(e) => setFormData({...formData, case_conferencing_awarded: e.target.checked})}
                                                        style={{width: '18px', height: '18px', cursor: 'pointer'}} />
                                                    <span className="form-label" style={{margin: 0}}>Awarded through Case Conferencing</span>
                                                </label>
                                            </div>

                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label className="form-label">Voucher Date Awarded</label>
                                                    <input type="date" className="form-input" value={formData.voucher_date || ''}
                                                        onChange={(e) => setFormData({...formData, voucher_date: e.target.value || null})}
                                                        required={formData.voucher_awarded} />
                                                </div>
                                                <div className="form-group">
                                                    <label className="form-label">Subsidy Type</label>
                                                    <select className="form-select" value={formData.subsidy_type}
                                                        onChange={(e) => setFormData({...formData, subsidy_type: e.target.value})}>
                                                        <option value="">Select subsidy...</option>
                                                        <option value="PSH">PSH (Permanent Supportive Housing)</option>
                                                        <option value="Rapid Rehousing">Rapid Rehousing</option>
                                                        <option value="City of Bangor">City of Bangor</option>
                                                        <option value="Section 8">Section 8</option>
                                                        <option value="Other">Other</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label className="form-label">Voucher Type</label>
                                                    <select className="form-select" value={formData.voucher_type}
                                                        onChange={(e) => setFormData({...formData, voucher_type: e.target.value})}
                                                        required={formData.voucher_awarded}>
                                                        <option value="">Select type...</option>
                                                        <option value="rapid_rehousing">Rapid Rehousing</option>
                                                        <option value="permanent_supportive">Permanent Supportive Housing</option>
                                                        <option value="emergency_housing">Emergency Housing</option>
                                                        <option value="transitional">Transitional Housing</option>
                                                        <option value="rental_assistance">Rental Assistance</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>
                                                <div className="form-group">
                                                    <label className="form-label">Voucher Amount/Value</label>
                                                    <input type="text" className="form-input" value={formData.voucher_amount}
                                                        onChange={(e) => setFormData({...formData, voucher_amount: e.target.value})}
                                                        placeholder="e.g., $1,200/month" />
                                                </div>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">Subsidy Provider Status</label>
                                                <select className="form-select" value={formData.subsidy_provider_status}
                                                    onChange={(e) => setFormData({...formData, subsidy_provider_status: e.target.value})}>
                                                    <option value="">Select status...</option>
                                                    <option value="pending">Pending Subsidy Approval</option>
                                                    <option value="approved">Approved by Subsidy</option>
                                                    <option value="denied">Denied by Subsidy</option>
                                                    <option value="housed">Client Housed</option>
                                                </select>
                                            </div>

                                            {formData.subsidy_provider_status === 'housed' && (
                                                <>
                                                    <h4 style={{marginTop: '1.5rem', marginBottom: '1rem', color: 'var(--color-success)'}}>üè† Landlord Information</h4>
                                                    <div className="form-row">
                                                        <div className="form-group">
                                                            <label className="form-label">Landlord Name</label>
                                                            <input type="text" className="form-input" value={formData.landlord_name}
                                                                onChange={(e) => setFormData({...formData, landlord_name: e.target.value})} />
                                                        </div>
                                                        <div className="form-group">
                                                            <label className="form-label">Landlord Phone</label>
                                                            <input type="tel" className="form-input" value={formData.landlord_phone}
                                                                onChange={(e) => setFormData({...formData, landlord_phone: e.target.value})} />
                                                        </div>
                                                    </div>
                                                    <div className="form-row">
                                                        <div className="form-group">
                                                            <label className="form-label">Landlord Email</label>
                                                            <input type="email" className="form-input" value={formData.landlord_email}
                                                                onChange={(e) => setFormData({...formData, landlord_email: e.target.value})} />
                                                        </div>
                                                        <div className="form-group">
                                                            <label className="form-label">Property Address</label>
                                                            <input type="text" className="form-input" value={formData.property_address}
                                                                onChange={(e) => setFormData({...formData, property_address: e.target.value})} />
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </>
                                    )}

                                    <button type="submit" className="btn btn-primary">Save Entry</button>
                                </form>
                            </div>
                        )}

                        {activeTab === 'view' && (
                            <>
                                {selectedEntry && (
                                    <div className="modal-overlay" onClick={() => setSelectedEntry(null)}>
                                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                            <div className="modal-header">
                                                <h3>Client Details: {selectedEntry.client_id}</h3>
                                                <div style={{display: 'flex', gap: '0.5rem'}}>
                                                    <button className="btn btn-primary btn-sm" onClick={(e) => {
                                                        e.stopPropagation();
                                                        setEditingEntry({...selectedEntry});
                                                        setSelectedEntry(null);
                                                    }}>‚úèÔ∏è Edit</button>
                                                    <button className="modal-close" onClick={() => setSelectedEntry(null)}>√ó</button>
                                                </div>
                                            </div>
                                            <div className="modal-body">
                                                <div className="detail-section">
                                                    <h4>Basic Information</h4>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Client ID</div>
                                                        <div className="detail-value">{selectedEntry.client_id}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">HMIS ID</div>
                                                        <div className="detail-value">{selectedEntry.hmis_id || 'Not provided'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Date of Birth</div>
                                                        <div className="detail-value">{selectedEntry.dob || 'Not provided'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">CE Score</div>
                                                        <div className="detail-value">
                                                            {selectedEntry.ce_score ? (
                                                                isCEHighPriority(selectedEntry.ce_score) ? 
                                                                <span className="ce-high-priority">üî• {selectedEntry.ce_score} (HIGH PRIORITY)</span> : 
                                                                selectedEntry.ce_score
                                                            ) : 'Not assessed'}
                                                        </div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Case Manager</div>
                                                        <div className="detail-value">{selectedEntry.case_manager || 'Not assigned'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Entry Date</div>
                                                        <div className="detail-value">{selectedEntry.entry_date}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Last Service Date</div>
                                                        <div className="detail-value">{selectedEntry.last_service_date || 'Not recorded'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Entry Type</div>
                                                        <div className="detail-value">{selectedEntry.entry_type}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">MyEvolv Entry Level</div>
                                                        <div className="detail-value">{selectedEntry.myevolv_entry_level || 'Not specified'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Status</div>
                                                        <div className="detail-value">{selectedEntry.status}</div>
                                                    </div>
                                                </div>

                                                <div className="detail-section">
                                                    <h4>Documentation Status</h4>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Has Insurance</div>
                                                        <div className="detail-value">
                                                            {selectedEntry.has_insurance ? '‚úì Yes' : '‚úó No'}
                                                        </div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Has Social Security Info</div>
                                                        <div className="detail-value">
                                                            {selectedEntry.has_ssn ? '‚úì Yes' : '‚úó No'}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="detail-section">
                                                    <h4>System Entry Status</h4>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Entered in HMIS</div>
                                                        <div className="detail-value">{selectedEntry.hmis_entered ? '‚úì Yes' : '‚úó No'}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Entered in MyEvolv</div>
                                                        <div className="detail-value">{selectedEntry.myevolv_entered ? '‚úì Yes' : '‚úó No'}</div>
                                                    </div>
                                                </div>

                                                {selectedEntry.voucher_awarded && (
                                                    <div className="detail-section">
                                                        <h4>üé´ Voucher Information</h4>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Case Conferencing</div>
                                                            <div className="detail-value">{selectedEntry.case_conferencing_awarded ? '‚úì Yes' : '‚úó No'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Voucher Date</div>
                                                            <div className="detail-value">{selectedEntry.voucher_date || 'Not specified'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Subsidy Type</div>
                                                            <div className="detail-value">{selectedEntry.subsidy_type || 'Not specified'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Voucher Type</div>
                                                            <div className="detail-value">{selectedEntry.voucher_type || 'Not specified'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Voucher Amount</div>
                                                            <div className="detail-value">{selectedEntry.voucher_amount || 'Not specified'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Subsidy Provider Status</div>
                                                            <div className="detail-value">{selectedEntry.subsidy_provider_status || 'Pending'}</div>
                                                        </div>
                                                    </div>
                                                )}

                                                {selectedEntry.subsidy_provider_status === 'housed' && (
                                                    <div className="detail-section">
                                                        <h4>üè† Landlord Information</h4>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Landlord Name</div>
                                                            <div className="detail-value">{selectedEntry.landlord_name || 'Not provided'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Landlord Phone</div>
                                                            <div className="detail-value">{selectedEntry.landlord_phone || 'Not provided'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Landlord Email</div>
                                                            <div className="detail-value">{selectedEntry.landlord_email || 'Not provided'}</div>
                                                        </div>
                                                        <div className="detail-row">
                                                            <div className="detail-label">Property Address</div>
                                                            <div className="detail-value">{selectedEntry.property_address || 'Not provided'}</div>
                                                        </div>
                                                    </div>
                                                )}

                                                {selectedEntry.notes && (
                                                    <div className="detail-section">
                                                        <h4>üìù Notes</h4>
                                                        <div style={{padding: '1rem', background: 'var(--color-bg)', borderRadius: '6px', fontFamily: 'var(--font-mono)', fontSize: '0.875rem', whiteSpace: 'pre-wrap'}}>
                                                            {selectedEntry.notes}
                                                        </div>
                                                    </div>
                                                )}

                                                <div className="detail-section">
                                                    <h4>Tracking Information</h4>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Logged By</div>
                                                        <div className="detail-value">{selectedEntry.user_email}</div>
                                                    </div>
                                                    <div className="detail-row">
                                                        <div className="detail-label">Created At</div>
                                                        <div className="detail-value">{new Date(selectedEntry.created_at).toLocaleString()}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="system-filter-buttons">
                                    <button className={`filter-btn ${systemFilter === 'all' ? 'active' : ''}`}
                                        onClick={() => setSystemFilter('all')}>
                                        All Entries ({entries.length})
                                    </button>
                                    <button className={`filter-btn ${systemFilter === 'hmis_only' ? 'active' : ''}`}
                                        onClick={() => setSystemFilter('hmis_only')}>
                                        HMIS Only ({stats.hmisOnly})
                                    </button>
                                    <button className={`filter-btn ${systemFilter === 'myevolv_only' ? 'active' : ''}`}
                                        onClick={() => setSystemFilter('myevolv_only')}>
                                        MyEvolv Only ({stats.myevolvOnly})
                                    </button>
                                    <button className={`filter-btn ${systemFilter === 'both' ? 'active' : ''}`}
                                        onClick={() => setSystemFilter('both')}>
                                        Both Systems ({stats.both})
                                    </button>
                                    <button className={`filter-btn ${systemFilter === 'neither' ? 'active' : ''}`}
                                        onClick={() => setSystemFilter('neither')}>
                                        Neither System ({stats.neither})
                                    </button>
                                </div>

                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-label">Total Entries</div>
                                        <div className="stat-value">{stats.total}</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-label">This Week</div>
                                        <div className="stat-value">{stats.thisWeek}</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-label">This Month</div>
                                        <div className="stat-value">{stats.thisMonth}</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-label">HMIS Only</div>
                                        <div className="stat-value">{stats.hmisOnly}</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-label">MyEvolv Only</div>
                                        <div className="stat-value">{stats.myevolvOnly}</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-label">Both Systems</div>
                                        <div className="stat-value">{stats.both}</div>
                                    </div>
                                </div>

                                <div className="table-container">
                                    <div className="table-header">
                                        <h3>All Entries (Click to view details)</h3>
                                        <div className="search-box">
                                            <input type="text" className="search-input" placeholder="Search entries..."
                                                value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                        </div>
                                    </div>
                                    
                                    {filteredEntries.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üìã</div>
                                            <p>No entries found.</p>
                                        </div>
                                    ) : (
                                        <div className="table-wrapper">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Client ID</th>
                                                        <th>Case Manager</th>
                                                        <th>Entry Type</th>
                                                        <th>HMIS</th>
                                                        <th>MyEvolv</th>
                                                        <th>CE Score</th>
                                                        <th>Docs</th>
                                                        <th>Voucher</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {filteredEntries.map((entry) => (
                                                        <tr key={entry.id} 
                                                            onClick={() => setSelectedEntry(entry)}
                                                            style={entry.voucher_awarded ? {background: 'rgba(237, 137, 54, 0.05)', borderLeft: '3px solid var(--color-warning)'} : {}}>
                                                            <td className="mono">{entry.entry_date}</td>
                                                            <td className="mono">{entry.client_id}</td>
                                                            <td>{entry.case_manager || '-'}</td>
                                                            <td>{entry.entry_type}</td>
                                                            <td style={{textAlign: 'center'}}>{entry.hmis_entered ? '‚úì' : '-'}</td>
                                                            <td style={{textAlign: 'center'}}>{entry.myevolv_entered ? '‚úì' : '-'}</td>
                                                            <td>
                                                                {entry.ce_score ? (
                                                                    isCEHighPriority(entry.ce_score) ? 
                                                                    <span className="ce-high-priority">üî• {entry.ce_score}</span> : 
                                                                    entry.ce_score
                                                                ) : '-'}
                                                            </td>
                                                            <td style={{textAlign: 'center'}}>
                                                                {entry.has_insurance && entry.has_ssn ? '‚úì‚úì' : 
                                                                 entry.has_insurance || entry.has_ssn ? '‚úì' : '-'}
                                                            </td>
                                                            <td style={{textAlign: 'center'}}>
                                                                {entry.voucher_awarded ? (
                                                                    <span title={`${entry.subsidy_type || entry.voucher_type} - ${entry.subsidy_provider_status}`} style={{fontSize: '1.2rem'}}>üé´</span>
                                                                ) : '-'}
                                                            </td>
                                                            <td>
                                                                <span className={`status-badge status-${entry.status}`}>{entry.status}</span>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {activeTab === 'reports' && (
                            <>
                                <div className="card">
                                    <h3>üìä PATH Monthly Reports</h3>
                                    <div className="form-row" style={{marginBottom: '2rem'}}>
                                        <div className="form-group">
                                            <label className="form-label">Start Date</label>
                                            <input type="date" className="form-input" id="report-start-date"
                                                defaultValue={new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0]} />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">End Date</label>
                                            <input type="date" className="form-input" id="report-end-date"
                                                defaultValue={new Date().toISOString().split('T')[0]} />
                                        </div>
                                    </div>
                                    <div className="form-row" style={{marginBottom: '2rem'}}>
                                        <div className="form-group">
                                            <label className="form-label">Filter by System Entry</label>
                                            <select className="form-select" id="report-entry-status">
                                                <option value="">All Entries</option>
                                                <option value="hmis_only">HMIS Only</option>
                                                <option value="myevolv_only">MyEvolv Only</option>
                                                <option value="both">Both Systems</option>
                                                <option value="neither">Neither System</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div style={{display: 'flex', gap: '1rem'}}>
                                        <button className="btn btn-primary" onClick={() => {
                                        const startDate = document.getElementById('report-start-date').value;
                                        const endDate = document.getElementById('report-end-date').value;
                                        const statusFilter = document.getElementById('report-entry-status').value;
                                        
                                        let filtered = entries.filter(e => {
                                            const eDate = new Date(e.entry_date);
                                            return eDate >= new Date(startDate) && eDate <= new Date(endDate);
                                        });

                                        if (statusFilter) {
                                            if (statusFilter === 'hmis_only') filtered = filtered.filter(e => e.hmis_entered && !e.myevolv_entered);
                                            else if (statusFilter === 'myevolv_only') filtered = filtered.filter(e => e.myevolv_entered && !e.hmis_entered);
                                            else if (statusFilter === 'both') filtered = filtered.filter(e => e.hmis_entered && e.myevolv_entered);
                                            else if (statusFilter === 'neither') filtered = filtered.filter(e => !e.hmis_entered && !e.myevolv_entered);
                                        }
                                        
                                        const uniqueClients = [...new Set(filtered.map(e => e.client_id))];
                                        const vouchersIssued = filtered.filter(e => e.voucher_awarded).length;
                                        const housed = filtered.filter(e => e.subsidy_provider_status === 'housed').length;
                                        const highPriority = filtered.filter(e => isCEHighPriority(e.ce_score)).length;
                                        const hasInsurance = filtered.filter(e => e.has_insurance).length;
                                        const hasSSN = filtered.filter(e => e.has_ssn).length;
                                        const fullyDocumented = filtered.filter(e => e.has_insurance && e.has_ssn).length;
                                        
                                        const caseManagers = {};
                                        filtered.forEach(e => {
                                            if (e.case_manager) {
                                                caseManagers[e.case_manager] = (caseManagers[e.case_manager] || 0) + 1;
                                            }
                                        });
                                        
                                        const report = `PATH MONTHLY REPORT
Period: ${startDate} to ${endDate}
Generated: ${new Date().toLocaleDateString()}
${statusFilter ? `System Filter: ${statusFilter}` : ''}

=================================
SUMMARY STATISTICS
=================================
Total Unique Clients: ${uniqueClients.length}
Total Interactions: ${filtered.length}
Vouchers Awarded: ${vouchersIssued}
Clients Housed: ${housed}
High Priority (CE 14-16): ${highPriority}

SYSTEM ENTRY STATUS:
- Entered in HMIS: ${filtered.filter(e => e.hmis_entered).length}
- Entered in MyEvolv: ${filtered.filter(e => e.myevolv_entered).length}
- Entered in Both: ${filtered.filter(e => e.hmis_entered && e.myevolv_entered).length}
- Not Entered: ${filtered.filter(e => !e.hmis_entered && !e.myevolv_entered).length}

DOCUMENTATION STATUS:
- Has Insurance: ${hasInsurance}
- Has Social Security: ${hasSSN}
- Fully Documented: ${fullyDocumented}

CASE MANAGERS:
${Object.entries(caseManagers).map(([name, count]) => `- ${name}: ${count} clients`).join('\n')}

=================================
DETAILED CLIENT LIST
=================================
${uniqueClients.map(clientId => {
    const clientEntries = filtered.filter(e => e.client_id === clientId);
    const latest = clientEntries[0];
    const hasVoucher = clientEntries.some(e => e.voucher_awarded);
    const voucherInfo = hasVoucher ? clientEntries.find(e => e.voucher_awarded) : null;
    
    return `Client: ${clientId} ${isCEHighPriority(latest.ce_score) ? 'üî• HIGH PRIORITY' : ''}
HMIS ID: ${latest.hmis_id || 'Not provided'}
DOB: ${latest.dob || 'Not provided'}
CE Score: ${latest.ce_score || 'Not assessed'}
Case Manager: ${latest.case_manager || 'Not assigned'}
Last Service: ${latest.last_service_date || 'Not recorded'}
Insurance: ${latest.has_insurance ? 'Yes' : 'No'} | Social Security: ${latest.has_ssn ? 'Yes' : 'No'}
System Entry: ${latest.hmis_entered ? 'HMIS' : ''} ${latest.myevolv_entered ? 'MyEvolv' : ''} ${!latest.hmis_entered && !latest.myevolv_entered ? 'NOT ENTERED' : ''}
Total Interactions: ${clientEntries.length}
Entry Types: ${[...new Set(clientEntries.map(e => e.entry_type))].join(', ')}
${voucherInfo ? `
Voucher Info:
- Type: ${voucherInfo.subsidy_type || voucherInfo.voucher_type}
- Status: ${voucherInfo.subsidy_provider_status}
- Case Conferencing: ${voucherInfo.case_conferencing_awarded ? 'Yes' : 'No'}
- Date Awarded: ${voucherInfo.voucher_date}
${voucherInfo.subsidy_provider_status === 'housed' && voucherInfo.landlord_name ? `
Landlord: ${voucherInfo.landlord_name}
Phone: ${voucherInfo.landlord_phone || 'N/A'}
Address: ${voucherInfo.property_address || 'N/A'}` : ''}` : ''}
---`;
}).join('\n')}`.trim();
                                        
                                        const blob = new Blob([report], { type: 'text/plain' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `path-report-${startDate}-to-${endDate}.txt`;
                                        a.click();
                                        URL.revokeObjectURL(url);
                                        
                                        setMessage({ type: 'success', text: 'Report downloaded!' });
                                        setTimeout(() => setMessage({ type: '', text: '' }), 3000);
                                    }}>
                                        Generate & Download Report
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => {
                                        const startDate = document.getElementById('report-start-date').value;
                                        const endDate = document.getElementById('report-end-date').value;
                                        const statusFilter = document.getElementById('report-entry-status').value;
                                        
                                        let filtered = entries.filter(e => {
                                            const eDate = new Date(e.entry_date);
                                            return eDate >= new Date(startDate) && eDate <= new Date(endDate);
                                        });

                                        if (statusFilter) {
                                            if (statusFilter === 'hmis_only') filtered = filtered.filter(e => e.hmis_entered && !e.myevolv_entered);
                                            else if (statusFilter === 'myevolv_only') filtered = filtered.filter(e => e.myevolv_entered && !e.hmis_entered);
                                            else if (statusFilter === 'both') filtered = filtered.filter(e => e.hmis_entered && e.myevolv_entered);
                                            else if (statusFilter === 'neither') filtered = filtered.filter(e => !e.hmis_entered && !e.myevolv_entered);
                                        }

                                        const headers = [
                                            'Client ID', 'HMIS ID', 'DOB', 'CE Score', 'Case Manager', 'Entry Date', 'Last Service Date',
                                            'Entry Type', 'MyEvolv Entry Level', 'Status', 'HMIS Entered', 'MyEvolv Entered',
                                            'Has Insurance', 'Has SSN',
                                            'Voucher Awarded', 'Case Conferencing', 'Voucher Date', 'Subsidy Type', 
                                            'Voucher Type', 'Voucher Amount', 'Subsidy Provider Status',
                                            'Landlord Name', 'Landlord Phone', 'Landlord Email', 'Property Address',
                                            'Notes', 'Logged By', 'Created At'
                                        ];

                                        const rows = filtered.map(e => [
                                            e.client_id || '',
                                            e.hmis_id || '',
                                            e.dob || '',
                                            e.ce_score || '',
                                            e.case_manager || '',
                                            e.entry_date || '',
                                            e.last_service_date || '',
                                            e.entry_type || '',
                                            e.myevolv_entry_level || '',
                                            e.status || '',
                                            e.hmis_entered ? 'Yes' : 'No',
                                            e.myevolv_entered ? 'Yes' : 'No',
                                            e.has_insurance ? 'Yes' : 'No',
                                            e.has_ssn ? 'Yes' : 'No',
                                            e.voucher_awarded ? 'Yes' : 'No',
                                            e.case_conferencing_awarded ? 'Yes' : 'No',
                                            e.voucher_date || '',
                                            e.subsidy_type || '',
                                            e.voucher_type || '',
                                            e.voucher_amount || '',
                                            e.subsidy_provider_status || '',
                                            e.landlord_name || '',
                                            e.landlord_phone || '',
                                            e.landlord_email || '',
                                            e.property_address || '',
                                            e.notes ? e.notes.replace(/"/g, '""') : '',
                                            e.user_email || '',
                                            e.created_at ? new Date(e.created_at).toLocaleString() : ''
                                        ]);

                                        const escapeCSV = (value) => {
                                            if (value === null || value === undefined) return '';
                                            const str = String(value);
                                            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                                                return `"${str.replace(/"/g, '""')}"`;
                                            }
                                            return str;
                                        };

                                        const csvContent = [
                                            headers.map(escapeCSV).join(','),
                                            ...rows.map(row => row.map(escapeCSV).join(','))
                                        ].join('\n');

                                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = `path-report-${startDate}-to-${endDate}.csv`;
                                        a.click();
                                        URL.revokeObjectURL(url);

                                        setMessage({ type: 'success', text: 'CSV exported successfully!' });
                                        setTimeout(() => setMessage({ type: '', text: '' }), 3000);
                                    }}>
                                        Export as CSV
                                    </button>
                                    </div>
                                </div>

                                <div className="table-container">
                                    <div className="table-header">
                                        <h3>üé´ High Priority: Clients with Vouchers</h3>
                                    </div>
                                    
                                    {entries.filter(e => e.voucher_awarded).length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-state-icon">üé´</div>
                                            <p>No vouchers awarded yet</p>
                                        </div>
                                    ) : (
                                        <div className="table-wrapper">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>Client ID</th>
                                                        <th>Case Manager</th>
                                                        <th>Subsidy Type</th>
                                                        <th>Provider Status</th>
                                                        <th>Case Conf.</th>
                                                        <th>Voucher Date</th>
                                                        <th>Landlord</th>
                                                        <th>Property</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {entries.filter(e => e.voucher_awarded).map((entry) => (
                                                        <tr key={entry.id} style={{background: 'rgba(237, 137, 54, 0.05)'}}
                                                            onClick={() => setSelectedEntry(entry)}>
                                                            <td className="mono" style={{fontWeight: '600'}}>{entry.client_id}</td>
                                                            <td>{entry.case_manager || '-'}</td>
                                                            <td>{entry.subsidy_type || entry.voucher_type}</td>
                                                            <td>
                                                                <span className={`status-badge status-${entry.subsidy_provider_status === 'housed' ? 'completed' : 'pending'}`}>
                                                                    {entry.subsidy_provider_status || 'pending'}
                                                                </span>
                                                            </td>
                                                            <td style={{textAlign: 'center'}}>{entry.case_conferencing_awarded ? '‚úì' : '-'}</td>
                                                            <td className="mono">{entry.voucher_date}</td>
                                                            <td>{entry.landlord_name || '-'}</td>
                                                            <td>{entry.property_address || '-'}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
